<!doctype html>
<html>

<head>
  <title>porterbot controller</title>
</head>

<body>
  <div id="result"></div>
  <div id="joystick" style="width: 400px; height: 400px; position: absolute; border: 2px solid blue">
    
  </div>  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.4/socket.io.js"></script>
  <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
  <script src="static/virtualJoystick.js"></script>
  <script>
    $(function () {

      var socket = io('http://porterbot:8080');
      socket.on('connect', function(socket){
        console.log('connected to server');
      });

      var joystick = new VirtualJoystick({
        stationaryBase: true,
        baseX: 200,
        baseY: 200,
        limitStickTravel: true,
        stickRadius: 150,
        mouseSupport: true,
        container: $('#joystick')[0]
      });

      console.log("touchscreen is", VirtualJoystick.touchScreenAvailable() ? "available" : "not available");

      joystick.addEventListener('touchStart', function(){
				console.log('down')
			})
			joystick.addEventListener('touchEnd', function(){
        console.log('up')        
        joystick.resetDelta()
        var joystickState = {x: 0, y: 0};        
        socket.emit('joystickState', joystickState);
      })
      joystick.addEventListener('touchMove', function(){
        var joystickState = {x: joystick.deltaX(), y: joystick.deltaY()};
        socket.emit('joystickState', joystickState);
      })
      
      setInterval(function(){        
        var outputEl	= document.getElementById('result');
				outputEl.innerHTML	= '<b>Result:</b> '
					+ ' dx:'+joystick.deltaX()
					+ ' dy:'+joystick.deltaY()
					+ (joystick.right()	? ' right'	: '')
					+ (joystick.up()	? ' up'		: '')
					+ (joystick.left()	? ' left'	: '')
          + (joystick.down()	? ' down' 	: '')
			}, 100);
    });
  </script>
</body>

</html>